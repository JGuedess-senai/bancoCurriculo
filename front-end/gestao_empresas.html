<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestão de Empresas — Painel ADM</title>
  <script src="https://kit.fontawesome.com/e66b0e408d.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--primary:#ff0000;--muted:#6c757d}
    body{margin:0;font-family:'Poppins',sans-serif;background:#f4f6f9}
    h1,h2{font-family:'Russo One',sans-serif}

    .sidebar{position:fixed;left:0;top:0;bottom:0;width:290px;background:linear-gradient(180deg,#000 0%,#1a1a1a 100%);color:#fff;padding:25px;display:flex;flex-direction:column;overflow-y:auto;height:100vh;z-index:1000;box-shadow:2px 0 15px rgba(0,0,0,.3);transition:width .3s}
    .sidebar-top{display:flex;flex-direction:column}
    .sidebar h2{margin:0 0 35px;text-align:center;font-weight:bold;font-size:1.6rem;letter-spacing:1.5px}
    .sidebar ul{list-style:none;padding:0;margin:0;flex-grow:1}
    .sidebar ul li{margin:20px 0;font-size:16px}
    .sidebar ul li a{color:white;text-decoration:none;font-weight:bold;padding:14px 18px;display:flex;align-items:center;border-radius:8px;transition:all .3s}
    .sidebar ul li a:hover{background-color:var(--primary);transform:translateX(5px);box-shadow:0 4px 10px rgba(255,0,0,.3)}
    .sidebar ul li a i{margin-right:12px;width:20px}

    .profile-section{margin-top:auto;position:relative;padding:0 15px 25px;border-top:1px solid rgba(255,255,255,.1);overflow:visible}
    .custom-dropdown{position:relative}
    .custom-dropdown-toggle{color:white;text-decoration:none;font-weight:bold;font-size:16px;display:flex;align-items:center;justify-content:space-between;padding:12px 30px;cursor:pointer;border-radius:8px;transition:all .2s;margin:0 -15px}
    .custom-dropdown-toggle:hover{background-color:rgba(255,0,0,.3);transform:scale(1.02)}
    .custom-dropdown-toggle i{transition:transform .2s}
    .custom-dropdown.active .custom-dropdown-toggle i{transform:rotate(180deg)}
    .custom-dropdown-menu{position:absolute;bottom:100%;left:0;right:0;margin-bottom:12px!important;background-color:var(--primary);color:white;border:none;border-radius:8px;box-shadow:0 8px 25px rgba(255,0,0,.4);z-index:1050;min-width:auto;padding:10px 0;list-style:none;opacity:0;transform:translateY(30px);visibility:hidden;transition:all .4s}
    .custom-dropdown.active .custom-dropdown-menu{opacity:1;transform:translateY(0);visibility:visible}
    .custom-dropdown-item{color:white;text-decoration:none;padding:12px 20px;border-bottom:1px solid rgba(255,255,255,.3);display:flex;align-items:center}
    .custom-dropdown-item:last-child{border-bottom:none}
    .custom-dropdown-item:hover{background-color:#e00000;color:white}

    .content{margin-left:290px;min-height:100vh;padding:40px;background:#f4f6f9;box-sizing:border-box}
    .card{background:linear-gradient(180deg,#fff,#fbfbfb);border:1px solid #eee;border-radius:10px;padding:18px;margin-bottom:16px}
    .small{color:var(--muted);font-size:.95rem}
    .placeholder-list{list-style:none;padding:0;margin:8px 0 0 0}
    .placeholder-list li{padding:10px 12px;background:#fff;border:1px solid #eee;border-radius:6px;margin-bottom:8px}
    .btn-modern{background:linear-gradient(135deg,#ff0000 0%,#e00000 100%);color:#fff;border:none;padding:12px 30px;border-radius:25px;font-weight:700}

    .stats-card{background:linear-gradient(135deg,#1c1c1c 0%,#2c2c2c 100%);color:white;border-radius:15px;padding:30px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.2);transition:transform .3s,box-shadow .3s;border:none}
    .stats-card i{font-size:3rem;color:var(--primary);margin-bottom:15px}
    .action-card{background:white;border-radius:15px;padding:30px;box-shadow:0 5px 20px rgba(0,0,0,.1);border-left:5px solid var(--primary)}

    @media(max-width:1199.98px){.sidebar{width:250px}.content{margin-left:250px;padding:30px}}
    @media(max-width:991.98px){.sidebar{width:100%;height:auto;position:relative;box-shadow:none;display:none!important}.content{margin-left:0;padding:20px}}

    .modal{z-index:1060}
    .modal-backdrop{background-color:rgba(0,0,0,.6);animation:fadeIn .3s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-content{background-color:#1c1c1c;color:white;border-radius:15px;border:none;box-shadow:0 10px 40px rgba(0,0,0,.5);animation:scaleIn .3s ease;margin-top:50px}
    @keyframes scaleIn{from{transform:scale(.8)}to{transform:scale(1)}}
    .modal-header{border-bottom:none;padding:30px 30px 0}
    .modal-header h2{color:white;font-family:'Russo One';margin:0;font-size:1.8rem}
    .modal-header i{color:var(--primary)}
    .modal-body{padding:0 30px 30px}
    .modal-body hr{border-color:#333;margin:20px 0}
    .modal-body h3,.modal-body h4{color:#fff;margin-bottom:10px;font-family:'Russo One'}
    .btn-close{filter:invert(1);opacity:.7;transition:opacity .3s}
    .btn-close:hover{opacity:1}
  </style>
</head>
<body>
  <!-- Navbar Mobile -->
  <nav class="navbar navbar-dark bg-dark d-lg-none">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Painel ADM</span>
      <div class="d-flex align-items-center justify-content-center flex-grow-1">
        <img src="../img/logo3.png" alt="etec-conecta" class="navbar-logo-mobile">
      </div>
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas" aria-controls="sidebarOffcanvas">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>

  <div class="container-fluid p-0 m-0">
    <!-- Sidebar Desktop -->
    <nav class="sidebar d-none d-lg-flex flex-column">
      <div class="sidebar-top">
        <h2>Painel ADM</h2>
        <ul>
          <li><a href="painel_admin.html"><i class="fa-solid fa-house"></i>Inicio</a></li>
          <li><a href="gestao_alunos.html"><i class="fa-solid fa-user-graduate"></i> Gestão de Alunos</a></li>
        </ul>
      </div>

      <!-- Profile Dropdown -->
      <div class="profile-section">
        <div class="custom-dropdown">
          <a class="custom-dropdown-toggle" href="#" role="button">
            <span id="adminName">Administrador</span>
            <i class="fa-solid fa-chevron-up"></i>
          </a>
          <ul class="custom-dropdown-menu">
            <li><a class="custom-dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#configuracoesModal"><i class="fa-solid fa-gear"></i>Configurações</a></li>
            <li><a class="custom-dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#ajudaModal"><i class="fa-solid fa-circle-info"></i>Ajuda</a></li>
            <li><a class="custom-dropdown-item btn-sair" href="index.html"><i class="fa-solid fa-right-from-bracket"></i>Sair</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Sidebar Mobile (Offcanvas) -->
    <div class="offcanvas offcanvas-start bg-dark text-white" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">Painel ADM</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="list-unstyled">
          <li class="mb-3">
            <a href="gestao_empresas.html" class="text-white text-decoration-none d-flex align-items-center p-2 rounded nav-link-mobile">
              <i class="fa-solid fa-building me-3"></i>Gestão de Empresas
            </a>
          </li>
          <li class="mb-3">
            <a href="gestao_alunos.html" class="text-white text-decoration-none d-flex align-items-center p-2 rounded nav-link-mobile">
              <i class="fa-solid fa-user-graduate me-3"></i>Gestão de Alunos
            </a>
          </li>
        </ul>

        <hr class="text-white">

        <div class="custom-dropdown-mobile">
          <a class="custom-dropdown-toggle-mobile" href="#" role="button">
            <i class="fa-solid fa-circle-user me-2"></i><span id="adminNameMobile">Administrador</span>
            <i class="fa-solid fa-chevron-up"></i>
          </a>
          <ul class="custom-dropdown-menu-mobile">
            <li><a class="custom-dropdown-item-mobile mobile-modal-trigger" href="#" data-modal-target="#configuracoesModal"><i class="fa-solid fa-gear me-2"></i>Configurações</a></li>
            <li><a class="custom-dropdown-item-mobile mobile-modal-trigger" href="#" data-modal-target="#ajudaModal"><i class="fa-solid fa-circle-info me-2"></i>Ajuda</a></li>
            <li><a class="custom-dropdown-item-mobile btn-sair" href="index.html"><i class="fa-solid fa-right-from-bracket me-2"></i>Sair</a></li>
          </ul>
        </div>
      </div>
    </div>

    <main class="content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="mb-1">Gestão de Empresas</h1>
        <div class="small">Lista completa de cadastros — ações visuais (apenas front-end).</div>
      </div>
    </div>

    <div class="table-card">
      <div class="d-flex justify-content-end mb-2">
        <button class="btn-modern" id="btn-refresh">Atualizar</button>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="empresas-tbody">
            <tr><td>Empresa Alpha</td><td>alpha@exemplo.com</td><td><span class="badge bg-warning text-dark">Pendente</span></td><td><button class="btn btn-sm btn-success me-1 aprovar">Aprovar</button><button class="btn btn-sm btn-outline-secondary ver">Ver</button></td></tr>
            <tr><td>Empresa Beta</td><td>beta@exemplo.com</td><td><span class="badge bg-success">Aprovada</span></td><td><button class="btn btn-sm btn-outline-secondary ver">Ver</button></td></tr>
            <tr><td>Empresa Gama</td><td>gama@exemplo.com</td><td><span class="badge bg-warning text-dark">Pendente</span></td><td><button class="btn btn-sm btn-success me-1 aprovar">Aprovar</button><button class="btn btn-sm btn-danger remover">Remover</button></td></tr>
          </tbody>
        </table>
      </div>
    </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script>
    // Carregar empresas pendentes do backend
    async function carregarEmpresas() {
      const tbody = document.getElementById('empresas-tbody');
      tbody.innerHTML = '<tr><td colspan="4">Carregando...</td></tr>';
      try {
        const res = await fetch('../back-end/list_empresas.php');
        const empresas = await res.json();
        tbody.innerHTML = '';
        empresas.forEach(emp => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${emp.nome}</td>
            <td>${emp.email}</td>
            <td><span class="badge ${emp.estado === 'aprovada' ? 'bg-success' : 'bg-warning text-dark'}">${emp.estado.charAt(0).toUpperCase() + emp.estado.slice(1)}</span></td>
            <td>
              ${emp.estado === 'pendente' ? `<button class="btn btn-sm btn-success me-1 aprovar" data-id="${emp.id}">Aprovar</button><button class="btn btn-sm btn-danger rejeitar" data-id="${emp.id}">Rejeitar</button>` : `<button class="btn btn-sm btn-outline-secondary ver" data-id="${emp.id}">Ver</button>`}
            </td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan='4'>Erro ao carregar empresas</td></tr>`;
      }
    }

    document.addEventListener('click', async function(e){
      if(e.target.matches('.aprovar')){
        const id = e.target.getAttribute('data-id');
        const res = await fetch('../back-end/aprovar_empresa.php', { method: 'POST', body: new URLSearchParams({ id }) });
        const data = await res.json();
        alert(data.message);
        carregarEmpresas();
      }
      if(e.target.matches('.rejeitar')){
        const id = e.target.getAttribute('data-id');
        if(confirm('Rejeitar esta empresa?')){
          const res = await fetch('../back-end/rejeitar_empresa.php', { method: 'POST', body: new URLSearchParams({ id }) });
          const data = await res.json();
          alert(data.message);
          carregarEmpresas();
        }
      }
      if(e.target.matches('.ver')){
        alert('Visualizar perfil (visual)');
      }
    });

    window.addEventListener('load', carregarEmpresas);
    document.getElementById('btn-refresh').addEventListener('click', carregarEmpresas);

    // custom dropdowns
    document.addEventListener('DOMContentLoaded', function(){
      const customDropdown = document.querySelector('.custom-dropdown');
      const customToggle = document.querySelector('.custom-dropdown-toggle');
      const customDropdownMobile = document.querySelector('.custom-dropdown-mobile');
      const customToggleMobile = document.querySelector('.custom-dropdown-toggle-mobile');
      function setupDropdown(dropdown,toggle){ if(!dropdown||!toggle) return; toggle.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); dropdown.classList.toggle('active'); document.querySelectorAll('.custom-dropdown, .custom-dropdown-mobile').forEach(other=>{ if(other!==dropdown) other.classList.remove('active'); }); }); }
      setupDropdown(customDropdown, customToggle);
      setupDropdown(customDropdownMobile, customToggleMobile);
      document.addEventListener('click', function(e){ if(customDropdown && !customDropdown.contains(e.target)) customDropdown.classList.remove('active'); if(customDropdownMobile && !customDropdownMobile.contains(e.target) && !e.target.closest('.custom-dropdown-menu-mobile')) customDropdownMobile.classList.remove('active'); });
    });
  </script>
  <script>
    // Load companies into the table (tries backend, falls back to sample data)
    async function carregarEmpresas(){
      const tbody = document.getElementById('empresas-tbody');
      tbody.innerHTML = '<tr><td colspan="4">Carregando...</td></tr>';
      try{
        const res = await fetch('../back-end/list_empresas.php', {credentials:'include'});
        if(!res.ok) throw new Error('no-data');
        const data = await res.json();
        renderEmpresas(data);
      }catch(err){
        // fallback sample
        const sample = [
          {nome:'Empresa Alpha', email:'alpha@exemplo.com',aprovada:false},
          {nome:'Empresa Beta', email:'beta@exemplo.com',aprovada:true},
          {nome:'Empresa Gama', email:'gama@exemplo.com',aprovada:false}
        ];
        renderEmpresas(sample);
      }
    }

    function renderEmpresas(list){
      const tbody = document.getElementById('empresas-tbody');
      tbody.innerHTML = '';
      list.forEach(emp => {
        const tr = document.createElement('tr');
        const tdNome = document.createElement('td'); tdNome.textContent = emp.nome || '';
        const tdEmail = document.createElement('td'); tdEmail.textContent = emp.email || '';
        const tdStatus = document.createElement('td');
        tdStatus.innerHTML = emp.aprovada ? '<span class="badge bg-success">Aprovada</span>' : '<span class="badge bg-warning text-dark">Pendente</span>';
        const tdActions = document.createElement('td');
        if(!emp.aprovada){ const btn = document.createElement('button'); btn.className='btn btn-sm btn-success me-1 aprovar'; btn.textContent='Aprovar'; tdActions.appendChild(btn); }
        const ver = document.createElement('button'); ver.className='btn btn-sm btn-outline-secondary ver'; ver.textContent='Ver'; tdActions.appendChild(ver);
        tr.appendChild(tdNome); tr.appendChild(tdEmail); tr.appendChild(tdStatus); tr.appendChild(tdActions);
        tbody.appendChild(tr);
      });
    }

    document.getElementById('btn-refresh').addEventListener('click', function(e){ e.preventDefault(); carregarEmpresas(); });
    // init
    carregarEmpresas();
  </script>
  
  <!-- Mobile modal handling and page modals (copied from painel_admin) -->
  <script>
    // Mobile modal triggers: close offcanvas then open modal smoothly
    document.querySelectorAll('.mobile-modal-trigger').forEach(modalTrigger => {
      modalTrigger.addEventListener('click', function (e) {
        e.preventDefault(); e.stopPropagation();
        const modalId = this.getAttribute('data-modal-target');
        const modalElement = document.querySelector(modalId);
        if (modalElement) {
          const dropdown = this.closest('.custom-dropdown-mobile'); if (dropdown) dropdown.classList.remove('active');
          const offcanvasEl = document.getElementById('sidebarOffcanvas');
          const offcanvasInstance = offcanvasEl ? bootstrap.Offcanvas.getInstance(offcanvasEl) : null;
          if (offcanvasInstance) {
            offcanvasInstance.hide();
            setTimeout(() => { const modal = new bootstrap.Modal(modalElement); modal.show(); }, 300);
          } else { const modal = new bootstrap.Modal(modalElement); modal.show(); }
        }
      });
    });
  </script>

  <!-- Modal: Configurações -->
  <div class="modal fade" id="configuracoesModal" tabindex="-1" aria-labelledby="configuracoesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="configuracoesModalLabel"><i class="fa-solid fa-gear"></i> Configurações</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="row">
              <div class="col-12 col-md-6 mb-3">
                <label for="inputNomeAdmin" class="form-label">Nome</label>
                <input type="text" class="form-control" id="inputNomeAdmin" placeholder="Seu nome">
              </div>
              <div class="col-12 col-md-6 mb-3">
                <label for="inputEmailAdmin" class="form-label">Email</label>
                <input type="email" class="form-control" id="inputEmailAdmin" placeholder="admin@email.com" disabled>
              </div>
            </div>
            <div class="mb-3">
              <label for="inputSenhaAdmin" class="form-label">Alterar Senha</label>
              <input type="password" class="form-control" id="inputSenhaAdmin" placeholder="Nova senha">
            </div>
            <div class="row">
              <div class="col-12 col-md-6 mb-3">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="notificacoesEmail" checked>
                  <label class="form-check-label" for="notificacoesEmail">Receber notificações por email</label>
                </div>
              </div>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-danger">Salvar Configurações</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Ajuda -->
  <div class="modal fade" id="ajudaModal" tabindex="-1" aria-labelledby="ajudaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="ajudaModalLabel"><i class="fa-solid fa-circle-info"></i> Ajuda</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="accordion" id="accordionAjuda">
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Perguntas Frequentes</button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionAjuda">
                <div class="accordion-body">
                  <ul class="list-unstyled">
                    <li class="mb-3"><strong>Como publicar avisos?</strong><br>Use o formulário na esquerda para criar avisos visuais; integração com backend pode ser adicionada depois.</li>
                    <li class="mb-3"><strong>Como aprovar uma empresa?</strong><br>Acesse a lista de empresas e clique em "Aprovar" para alterar o status (visual por enquanto).</li>
                    <li class="mb-3"><strong>Como editar informações do programa?</strong><br>Na tela Administração, edite os campos e clique em "Salvar (visual)".</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Contato do Suporte</button>
              </h2>
              <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionAjuda">
                <div class="accordion-body">
                  <div class="row">
                    <div class="col-12 col-md-4 mb-3 text-center"><i class="fa-solid fa-envelope fa-2x text-danger mb-2"></i><p><strong>Email</strong><br>suporte@exemplo.com</p></div>
                    <div class="col-12 col-md-4 mb-3 text-center"><i class="fa-solid fa-phone fa-2x text-danger mb-2"></i><p><strong>Telefone</strong><br>(11) 1234-5678</p></div>
                    <div class="col-12 col-md-4 mb-3 text-center"><i class="fa-solid fa-comments fa-2x text-danger mb-2"></i><p><strong>Chat</strong><br>Disponível no canto inferior direito</p></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
